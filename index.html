<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фермерский магазин</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Фермерский магазин</h1>
        <!-- Каталог товаров -->
        <div id="catalog">
            <h2>Каталог товаров</h2>
            <div class="product" data-product-id="shiitake">
                <img src="images/shiitake.png" alt="Грибы Шиитаке">
                <div class="product-info">
                    <p class="product-name">Грибы Шиитаке</p>
                    <p class="product-price">300 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('shiitake')">Добавить</button>
            </div>
            <div class="product" data-product-id="pork-meat">
                <img src="images/pork-meat.png" alt="Свинной фарш">
                <div class="product-info">
                    <p class="product-name">Свинной фарш</p>
                    <p class="product-price">450 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('pork-meat')">Добавить</button>
            </div>
            <div class="product" data-product-id="crayfish">
                <img src="images/crayfish.png" alt="Раки">
                <div class="product-info">
                    <p class="product-name">Раки</p>
                    <p class="product-price">350 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('crayfish')">Добавить</button>
            </div>
            <div class="product" data-product-id="honey">
                <img src="images/honey.png" alt="Мед">
                <div class="product-info">
                    <p class="product-name">Мед</p>
                    <p class="product-price">400 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('honey')">Добавить</button>
            </div>
            <div class="product" data-product-id="cheese">
                <img src="images/cheese.png" alt="Домашний сыр">
                <div class="product-info">
                    <p class="product-name">Домашний сыр</p>
                    <p class="product-price">300 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('cheese')">Добавить</button>
            </div>
            <div class="product" data-product-id="vegetable-basket">
                <img src="images/vegetable-basket.png" alt="Овощная корзина">
                <div class="product-info">
                    <p class="product-name">Овощная корзина</p>
                    <p class="product-price">500 руб./корзина</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('vegetable-basket')">Добавить</button>
            </div>
        </div>
        <!-- Корзина -->
        <div id="cart" class="cart">
            <h2>Корзина</h2>
            <ul id="cart-items"></ul>
            <p class="total">Итого: <span id="total-price">0 руб.</span></p>
            <button id="checkout-btn" onclick="openCheckoutForm()" style="display: none;">Оформить заказ</button>
        </div>
        <!-- Форма оформления заказа -->
        <div id="checkout-form" class="checkout-form" style="display: none;">
            <h2>Оформление заказа</h2>
            <form id="order-form">
                <label for="address">Адрес доставки:</label>
                <input type="text" id="address" name="address" required>
                <label for="phone">Телефон:</label>
                <input type="tel" id="phone" name="phone" required>
                <label for="delivery-time">Время доставки:</label>
                <input type="datetime-local" id="delivery-time" name="delivery-time" required>
                <button type="submit">Подтвердить заказ</button>
            </form>
        </div>
    </div>
    <script>
        // Инициализация корзины
        let cart = {};
        let totalPrice = 0;

        // Добавление товара в корзину
        function addToCart(productId) {
            if (!cart[productId]) {
                cart[productId] = { quantity: 0, price: getProductPrice(productId) };
            }
            cart[productId].quantity += 1;
            updateCart();
        }

        // Обновление корзины
        function updateCart() {
            const cartItemsList = document.getElementById("cart-items");
            const totalPriceElement = document.getElementById("total-price");
            const checkoutBtn = document.getElementById("checkout-btn");

            cartItemsList.innerHTML = "";
            totalPrice = 0;

            for (const productId in cart) {
                const product = cart[productId];
                totalPrice += product.price * product.quantity;

                const li = document.createElement("li");
                li.textContent = `${getProductName(productId)} x ${product.quantity} = ${product.price * product.quantity} руб.`;
                cartItemsList.appendChild(li);
            }

            totalPriceElement.textContent = `${totalPrice} руб.`;

            if (totalPrice > 0) {
                checkoutBtn.style.display = "block";
            } else {
                checkoutBtn.style.display = "none";
            }
        }

        // Открытие формы оформления заказа
        function openCheckoutForm() {
            document.getElementById("checkout-form").style.display = "block";
        }

        // Обработка отправки формы
        document.getElementById("order-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            const address = document.getElementById("address").value;
            const phone = document.getElementById("phone").value;
            const deliveryTime = document.getElementById("delivery-time").value;

            const orderDetails = {
                products: cart,
                total_price: totalPrice,
                address,
                phone,
                delivery_time: deliveryTime
            };

            // Отправка данных администратору
            await sendOrderToAdmin(orderDetails);

            alert("Заказ успешно оформлен!");
            document.getElementById("checkout-form").style.display = "none";
            cart = {};
            totalPrice = 0;
            updateCart();
        });

        // Отправка данных администратору
        async function sendOrderToAdmin(orderDetails) {
            const adminMessage = JSON.stringify(orderDetails);
            window.Telegram.WebApp.sendData(adminMessage);
        }

        // Получение цены товара
        function getProductPrice(productId) {
            const prices = {
                shiitake: 300,
                porkMeat: 450,
                crayfish: 350,
                honey: 400,
                cheese: 300,
                vegetableBasket: 500
            };
            return prices[productId] || 0;
        }

        // Получение названия товара
        function getProductName(productId) {
            const names = {
                shiitake: "Грибы Шиитаке",
                porkMeat: "Свинной фарш",
                crayfish: "Раки",
                honey: "Мед",
                cheese: "Домашний сыр",
                vegetableBasket: "Овощная корзина"
            };
            return names[productId] || "Неизвестный товар";
        }
    </script>
</body>
</html>
