<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фермерский магазин</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Элитный фермерский магазин</h1>
            <p>Свежие, натуральные и премиальные продукты от лучших фермеров!</p>
        </header>
        <!-- Каталог товаров -->
        <div id="catalog">
            <h2>Каталог товаров</h2>
            <div class="product" data-product-id="truffle">
                <img src="images/truffle.png" alt="Грибы Трюфель">
                <div class="product-info">
                    <p class="product-name">Грибы Трюфель</p>
                    <p class="product-price">2500 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('truffle')">Добавить</button>
            </div>
            <div class="product" data-product-id="caviar">
                <img src="images/caviar.png" alt="Икра красная">
                <div class="product-info">
                    <p class="product-name">Икра красная</p>
                    <p class="product-price">3000 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('caviar')">Добавить</button>
            </div>
            <div class="product" data-product-id="beef-steak">
                <img src="images/beef-steak.png" alt="Стейк из говядины">
                <div class="product-info">
                    <p class="product-name">Стейк из говядины (ангиус)</p>
                    <p class="product-price">1200 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('beef-steak')">Добавить</button>
            </div>
            <div class="product" data-product-id="olive-oil">
                <img src="images/olive-oil.png" alt="Оливковое масло Extra Virgin">
                <div class="product-info">
                    <p class="product-name">Оливковое масло Extra Virgin</p>
                    <p class="product-price">800 руб./бутылка</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('olive-oil')">Добавить</button>
            </div>
            <div class="product" data-product-id="crayfish">
                <img src="images/crayfish.png" alt="Раки">
                <div class="product-info">
                    <p class="product-name">Раки</p>
                    <p class="product-price">350 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('crayfish')">Добавить</button>
            </div>
            <div class="product" data-product-id="honey">
                <img src="images/honey.png" alt="Мед липовый">
                <div class="product-info">
                    <p class="product-name">Мед липовый</p>
                    <p class="product-price">400 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('honey')">Добавить</button>
            </div>
            <div class="product" data-product-id="parmesan">
                <img src="images/parmesan.png" alt="Домашний сыр пармезан">
                <div class="product-info">
                    <p class="product-name">Домашний сыр пармезан</p>
                    <p class="product-price">500 руб./кг</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('parmesan')">Добавить</button>
            </div>
            <div class="product" data-product-id="vegetable-basket">
                <img src="images/vegetable-basket.png" alt="Овощная корзина премиум">
                <div class="product-info">
                    <p class="product-name">Овощная корзина премиум</p>
                    <p class="product-price">700 руб./корзина</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart('vegetable-basket')">Добавить</button>
            </div>
        </div>
        <!-- Корзина -->
        <div id="cart" class="cart">
            <h2>Корзина</h2>
            <ul id="cart-items"></ul>
            <p class="total">Итого: <span id="total-price">0 руб.</span></p>
            <button id="checkout-btn" onclick="openCheckoutForm()" style="display: none;">Оформить заказ</button>
        </div>
        <!-- Форма оформления заказа -->
        <div id="checkout-form" class="checkout-form" style="display: none;">
            <h2>Оформление заказа</h2>
            <form id="order-form">
                <label for="address">Адрес доставки:</label>
                <input type="text" id="address" name="address" required>
                <label for="phone">Телефон:</label>
                <input type="tel" id="phone" name="phone" required>
                <label for="delivery-time">Время доставки:</label>
                <input type="datetime-local" id="delivery-time" name="delivery-time" required>
                <button type="submit">Подтвердить заказ</button>
            </form>
        </div>
    </div>
    <script>
        // Инициализация корзины
        let cart = {};
        let totalPrice = 0;

        // Добавление товара в корзину
        function addToCart(productId) {
            if (!cart[productId]) {
                cart[productId] = { quantity: 0, price: getProductPrice(productId) };
            }
            cart[productId].quantity += 1;
            updateCart();
        }

        // Обновление корзины
        function updateCart() {
            const cartItemsList = document.getElementById("cart-items");
            const totalPriceElement = document.getElementById("total-price");
            const checkoutBtn = document.getElementById("checkout-btn");

            cartItemsList.innerHTML = "";
            totalPrice = 0;

            for (const productId in cart) {
                const product = cart[productId];
                totalPrice += product.price * product.quantity;

                const li = document.createElement("li");
                li.textContent = `${getProductName(productId)} x ${product.quantity} = ${product.price * product.quantity} руб.`;
                cartItemsList.appendChild(li);
            }

            totalPriceElement.textContent = `${totalPrice} руб.`;

            if (totalPrice > 0) {
                checkoutBtn.style.display = "block";
            } else {
                checkoutBtn.style.display = "none";
            }
        }

        // Открытие формы оформления заказа
        function openCheckoutForm() {
            document.getElementById("checkout-form").style.display = "block";
        }

        // Обработка отправки формы
        document.getElementById("order-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            const address = document.getElementById("address").value;
            const phone = document.getElementById("phone").value;
            const deliveryTime = document.getElementById("delivery-time").value;

            const orderDetails = {
                products: cart,
                total_price: totalPrice,
                address,
                phone,
                delivery_time: deliveryTime
            };

            // Отправка данных администратору
            await sendOrderToAdmin(orderDetails);

            alert("Заказ успешно оформлен!");
            document.getElementById("checkout-form").style.display = "none";
            cart = {};
            totalPrice = 0;
            updateCart();
        });

        // Отправка данных администратору
        async function sendOrderToAdmin(orderDetails) {
            const adminMessage = JSON.stringify(orderDetails);
            window.Telegram.WebApp.sendData(adminMessage);
        }

        // Получение цены товара
        function getProductPrice(productId) {
            const prices = {
                truffle: 2500,
                caviar: 3000,
                beefSteak: 1200,
                oliveOil: 800,
                crayfish: 350,
                honey: 400,
                parmesan: 500,
                vegetableBasket: 700
            };
            return prices[productId] || 0;
        }

        // Получение названия товара
        function getProductName(productId) {
            const names = {
                truffle: "Грибы Трюфель",
                caviar: "Икра красная",
                beefSteak: "Стейк из говядины (ангиус)",
                oliveOil: "Оливковое масло Extra Virgin",
                crayfish: "Раки",
                honey: "Мед липовый",
                parmesan: "Домашний сыр пармезан",
                vegetableBasket: "Овощная корзина премиум"
            };
            return names[productId] || "Неизвестный товар";
        }
    </script>
</body>
</html>
